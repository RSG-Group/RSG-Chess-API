!function(o,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rsg-chess",[],t):"object"==typeof exports?exports["rsg-chess"]=t():o["rsg-chess"]=t()}("undefined"!=typeof self?self:this,function(){return function(o){function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return o[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var e={};return t.m=o,t.c=e,t.d=function(o,e,r){t.o(o,e)||Object.defineProperty(o,e,{configurable:!1,enumerable:!0,get:r})},t.n=function(o){var e=o&&o.__esModule?function(){return o.default}:function(){return o};return t.d(e,"a",e),e},t.o=function(o,t){return Object.prototype.hasOwnProperty.call(o,t)},t.p="",t(t.s=2)}([function(o,t,e){"use strict";function r(o,t,e,r,i,n){if(e&&(this.char=e[r]),this.color=r,this.x=o,this.y=t,this.game=i,this.type=n,n){var c="knight"===n?"n":n.charAt(0);"W"===this.color&&(c=c.toUpperCase()),this.FENname=c}}function i(o,t,e,i){r.call(this,o,t,h.pawn,e,i,"pawn")}function n(o,t,e,i){r.call(this,o,t,h.rook,e,i,"rook")}function c(o,t,e,i){r.call(this,o,t,h.knight,e,i,"knight")}function a(o,t,e,i){r.call(this,o,t,h.bishop,e,i,"bishop")}function s(o,t,e,i){r.call(this,o,t,h.queen,e,i,"queen")}function u(o,t,e,i){r.call(this,o,t,h.king,e,i,"king")}Object.defineProperty(t,"__esModule",{value:!0});var h=t.PIECE_CHARS={pawn:{W:"♙",B:"♟"},rook:{W:"♖",B:"♜"},knight:{W:"♘",B:"♞"},bishop:{W:"♗",B:"♝"},queen:{W:"♕",B:"♛"},king:{W:"♔",B:"♚"}};r.empty=function(){return new r},r.prototype.getValidMoves=function(){return[{x:0,y:0},{x:7,y:7}]},i.prototype=r.empty(),i.prototype.getValidMoves=function(o){var t,e,r=this.game,i=[],n=this.y,c=this.x,a=r.board,s=r.turn,u=s.length,h="W"===this.color?n-1:n+1,l="W"===this.color?n-2:n+2,p=(this.color,[c-1,c+1]);h<8&&h>=0&&!a[h][c]&&(i.push({x:c,y:h}),(1===n||6===n)&&l<8&&l>=0&&!r.board[l][c]&&i.push({x:c,y:l}));for(var f=0;f<2;f++)e=p[f],h<8&&h>=0&&a[h][e]&&a[h][e].color!==this.color&&i.push({x:e,y:h});for(var y=0;y<2;y++)e=p[y],!(t=s[u-1])||t.to.x!==e||t.to.y!==n||t.color===this.color||1!==t.from.y&&6!==t.from.y||3!==n&&4!==n||i.push({x:e,y:h,movePiece:{piece:r.board[n][e],from:{x:e,y:n},to:null}});return o?r.simulateAndFilter(i,this):i},r.pawn=function(o,t,e,r){return new i(o,t,e,r)},n.prototype=r.empty(),n.prototype.getValidMoves=function(o){var t=this.game,e=[];[[-1,0],[1,0],[0,1],[0,-1]].forEach(function(o){var r,i,n,c;for(r=1;(i=this.x+o[0]*r,!((n=this.y+o[1]*r)<0||n>7||i<0||i>7))&&(!(c=t.board[n][i])||c.color!==this.color)&&(e.push({x:i,y:n}),!c);r++);},this);return o?t.simulateAndFilter(e,this):e},r.rook=function(o,t,e,r){return new n(o,t,e,r)},c.prototype=r.empty(),c.prototype.getValidMoves=function(o){for(var t,e,r=this.game,i=[],n=[[2,1],[-2,1],[1,2],[-1,2],[2,-1],[-2,-1],[1,-2],[-1,-2]],c=0;c<n.length;c++){var a,s=!1;t=n[c][0],e=n[c][1],this.x+t<8&&this.x+t>=0&&this.y+e<8&&this.y+e>=0&&(a=r.board[this.y+e][this.x+t],s=!a||a.color!==this.color),s&&i.push({x:this.x+t,y:this.y+e})}return o?r.simulateAndFilter(i,this):i},r.knight=function(o,t,e,r){return new c(o,t,e,r)},a.prototype=r.empty(),a.prototype.getValidMoves=function(o){var t=this.game,e=[];[[-1,-1],[1,1],[-1,1],[1,-1]].forEach(function(o){var r,i,n,c;for(r=1;(i=this.x+o[0]*r,!((n=this.y+o[1]*r)<0||n>7||i<0||i>7))&&(!(c=t.board[n][i])||c.color!==this.color)&&(e.push({x:i,y:n}),!c);r++);},this);return o?t.simulateAndFilter(e,this):e},r.bishop=function(o,t,e,r){return new a(o,t,e,r)},s.prototype=r.empty(),s.prototype.getValidMoves=function(o){var t=this.game,e=n.prototype.getValidMoves.call(this),r=a.prototype.getValidMoves.call(this),i=e.concat(r);return o?t.simulateAndFilter(i,this):i},r.queen=function(o,t,e,r){return new s(o,t,e,r)},u.prototype=r.empty(),u.prototype.getValidMoves=function(o){var t=[],e=[[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1],[-1,0],[1,0]],r=this.x,i=this.y,n=this.game,c=n.turn,a=this;e.forEach(function(o){var e,c=r+o[0],s=i+o[1];c<8&&c>=0&&s<8&&s>=0&&((e=n.board[s][c])&&e.color===a.color||t.push({x:c,y:s}))}),c.some(function(o){return"king"===o.type&&o.color===a.color})||[[0,2,-1],[7,6,1]].forEach(function(o){var e=o[0],s=o[1],u=o[2],h=n.board[i][e];if(h&&"rook"!==!h.type&&!c.some(function(o){return o.from.x===e&&o.from.y===i})){for(var l=r+u;l!==e;l+=u){if(n.board[i][l])return;var p=!0;if(n.board.forEach(function(o){o.forEach(function(o){o&&"king"!==o.type&&o.color!==a.color&&o.getValidMoves().forEach(function(o){o&&o.y===i&&o.x===l&&(p=!1)})})}),!p)return}var f={x:s,y:i,movePiece:{piece:a.game.board[i][e],from:{x:e,y:i},to:{y:i,x:r+u}}};t.push(f)}});return o?n.simulateAndFilter(t,a):t},r.king=function(o,t,e,r){return new u(o,t,e,r)},t.Piece=r,t.Pawn=i,t.Rook=n,t.Knight=c,t.Bishop=a,t.Queen=s,t.King=u},function(o,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(o){var t=o.board,e=null,r=-9999;return o.allMoves().forEach(function(n){var c=o.simpleMove(n),a=-i(t);a>r&&"B"===t[n.to.y][n.to.x].color&&(r=a,e={from:n.from,to:n.to}),c()}),e},i=function(o){for(var t=0,e=0;e<8;e++)for(var r=0;r<8;r++)t+=n(o[e][r]);return t},n=function(o){if(null===o)return 0;var t=function(o){return"pawn"===o.type?10:"rook"===o.type?50:"knight"===o.type?30:"bishop"===o.type?30:"queen"===o.type?90:"king"===o.type?900:void 0}(o,o.color);return"W"===o.color?t:-t};t.default=r},function(o,t,e){"use strict";function r(o){return o&&o.__esModule?o:{default:o}}Object.defineProperty(t,"__esModule",{value:!0}),t.Graphics=t.AI=t.Piece=t.Game=void 0;var i=e(3),n=r(i),c=e(0),a=function(o){if(o&&o.__esModule)return o;var t={};if(null!=o)for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e]);return t.default=o,t}(c),s=e(1),u=r(s);t.Game=n.default,t.Piece=a,t.AI=u.default,t.Graphics="This feature is coming soon!"},function(o,t,e){"use strict";function r(o){this.board=[];for(var t=0;t<8;t++){for(var e=[],r=0;r<8;r++)e.push(null);this.board.push(e)}this.turn=[],this.FEN=[],this.FENboard=[],this.threefold=[]}Object.defineProperty(t,"__esModule",{value:!0});var i=e(0),n=e(1),c=function(o){return o&&o.__esModule?o:{default:o}}(n);r.prototype.piece=function(o,t,e,r){var n=i.Piece[o](t,e,r,this);this.board[e][t]=n,this.FEN=this.gameToFEN(),this.FENboard=this.boardToFEN()},r.prototype.moveSelected=function(o,t,e,r,i,n){var a=t.x,s=t.y;if(o){var u={x:o.x,y:o.y};if(this.board[s][a]!==o){for(var h=o.getValidMoves(!n),l=null,p=0;p<h.length;p++){var f=h[p];if(f.x===a&&f.y===s){l=f;break}}if(!l)return!1;var y,v,d,m=l.movePiece;m&&(y=m.from,v=m.to,null===v?this.board[y.y][y.x]=null:(d=this.board[y.y][y.x],this.board[v.y][v.x]=d,d.x=v.x,d.y=v.y,this.board[y.y][y.x]=null));var g=this.board[s][a]?this.board[s][a]:null;m=m?l.movePiece:null,this.turn.push({from:u,to:t,color:o.color,type:o.type,piece:g,movePiece:m}),this.board[s][a]=o,this.board[o.y][o.x]=null,this.board[s][a].x=a,this.board[s][a].y=s,this.FEN=this.gameToFEN(),this.FENboard=this.boardToFEN(),this.threefold.push(this.FENboard),("pawn"===o.type||g)&&(this.threefold=[]),this.threefoldCheck()&&r("D"),this.halfmoveClock()>=50&&r("D"),"pawn"===o.type&&("W"===o.color&&0===s||"B"===o.color&&7===s)&&e&&(i||"B"!==o.color?e(o,a,s,o.color):this.promotePawn(o,a,s,o.color,"queen"));var x="W"===o.color?"B":"W",b=this.checkmate(x);if(b&&r(b),i){var k=(0,c.default)(this);this.moveSelected(this.board[k.from.y][k.from.x],k.to,e,r,!1,n)}}return o=null,!0}},r.prototype.promotePawn=function(o,t,e,r,i){this.piece(i,t,e,r)},r.prototype.simulateAndFilter=function(o,t){var e=[],r=this,i=this.board;return o.forEach(function(o,n){var c=o.y,a=o.x,s={x:t.x,y:t.y},u=i[c][a]?{piece:i[c][a],from:{x:a,y:c},to:null}:null;o.movePiece&&(u=o.movePiece),u&&r.simpleMovePiece(u.piece,u.from,u.to),r.simpleMovePiece(t,s,{x:a,y:c});var h=r.warning(t.color);r.simpleMovePiece(t,{x:a,y:c},s),u&&r.simpleMovePiece(u.piece,u.to,u.from),h||e.push(o)}),e},r.prototype.checkmate=function(o){for(var t=0;t<8;t++)for(var e=0;e<8;e++)if(this.board[t][e]&&this.board[t][e].color===o&&this.board[t][e].getValidMoves(!0).length)return!1;return this.warning(o)?o:"D"},r.prototype.simpleMovePiece=function(o,t,e){var r=this.board;e&&(r[e.y][e.x]=o,o.x=e.x,o.y=e.y),t&&(r[t.y][t.x]=null)},r.prototype.simpleMove=function(o){var t=this,e=t.board,r=o.from,i=o.to,n=e[r.y][r.x],c=e[i.y][i.x]?{piece:e[i.y][i.x],from:{x:i.x,y:i.y},to:null}:null;return i.movePiece&&(c=i.movePiece),c&&t.simpleMovePiece(c.piece,c.from,c.to),t.simpleMovePiece(n,r,{x:i.x,y:i.y}),function(){t.simpleMovePiece(n,{x:i.x,y:i.y},r),c&&t.simpleMovePiece(c.piece,c.to,c.from)}},r.prototype.warning=function(o){var t,e=!1;return this.board.forEach(function(e){e.forEach(function(e){e&&e.color===o&&"king"===e.type&&(t=e)})}),this.board.forEach(function(r){r.forEach(function(r){r&&r.color!==o&&r.getValidMoves().forEach(function(o){o.x===t.x&&o.y===t.y&&(e=!0)})})}),e},r.prototype.threefoldCheck=function(){for(var o=this.threefold,t=o.length,e=0;e<t;e++){for(var r=0,i=e+1;i<t;i++)o[e]===o[i]&&(r+=1);if(r>=2)return!0}return!1},r.prototype.pieceToAN=function(o,t){return"abcdefgh".charAt(o)+(8-t)},r.prototype.boardToFEN=function(){for(var o=this.board,t="",e=0,r=0;r<8;r++){for(var i=0;i<8;i++)o[r][i]?(e&&(t+=e),e=0,t+=o[r][i].FENname):e++;e&&(t+=e),e=0,t+=r<7?"/":""}return t},r.prototype.halfmoveClock=function(){var o=this.turn,t=o.length,e=0;if(0===o.length)return e;for(var r=o[t-1-e];e<=t-1&&"pawn"!==r.type&&!r.piece;)e++,r=o[t-1-e];return e},r.prototype.activeColour=function(){var o=this.turn;return o.length&&"W"===o[o.length-1].color?"b":"w"},r.prototype.castlingTarget=function(){var o,t,e=this.board,r=this.turn,i="";return r.forEach(function(e){o="king"===e.type&&"W"===e.color,t="king"===e.type&&"B"===e.color}),[[7,0],[0,0],[7,7],[0,7]].forEach(function(n){var c=n[0],a=n[1],s=e[a][c];if((7!==a||!o)&&(0!==a||!t)&&s&&"rook"!==!s.type&&!r.some(function(o){return"rook"===o.type&&(o.from.x===c&&o.from.y===a)})){var u=0===c?"q":"k";i+=0===a?u.toUpperCase():u}}),i||(i="-"),i},r.prototype.enPassantTarget=function(){var o=this.turn,t="";if(o.length){var e=o[o.length-1];"W"===e.color&&4===e.to.y&&(t=this.pieceToAN(e.to.x,e.to.y+1)),"B"===e.color&&3===e.to.y&&(t=this.pieceToAN(e.to.x,e.to.y-1))}return t||(t="-"),t},r.prototype.fullmoveCount=function(){var o=1;return this.turn.forEach(function(t){"B"===t.color&&(o+=1)}),o},r.prototype.gameToFEN=function(){var o="";return o+=this.boardToFEN(),o+=" "+this.activeColour(),o+=" "+this.castlingTarget(),o+=" "+this.enPassantTarget(),o+=" "+this.halfmoveClock(),o+=" "+this.fullmoveCount()},r.prototype.initializeGame=function(){for(var o=new r,t=0;t<8;t++)o.piece("pawn",t,6,"W"),o.piece("pawn",t,1,"B");return o.piece("rook",0,0,"B"),o.piece("knight",1,0,"B"),o.piece("bishop",2,0,"B"),o.piece("queen",3,0,"B"),o.piece("king",4,0,"B"),o.piece("bishop",5,0,"B"),o.piece("knight",6,0,"B"),o.piece("rook",7,0,"B"),o.piece("rook",0,7,"W"),o.piece("knight",1,7,"W"),o.piece("bishop",2,7,"W"),o.piece("queen",3,7,"W"),o.piece("king",4,7,"W"),o.piece("bishop",5,7,"W"),o.piece("knight",6,7,"W"),o.piece("rook",7,7,"W"),o},r.prototype.allMoves=function(){for(var o=this.board,t=[],e=this.activeColour().toUpperCase(),r=0;r<8;r++)for(var i=0;i<8;i++)if(o[r][i]&&o[r][i].color===e){var n=o[r][i].getValidMoves();n.forEach(function(e){t.push({color:o[r][i].color,from:{x:i,y:r},to:e,FENname:o[r][i].FENname})})}return t},t.default=r}])});
//# sourceMappingURL=index.js.map