!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("rsg-chess",[],e):"object"==typeof exports?exports["rsg-chess"]=e():t["rsg-chess"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(o[r])return o[r].exports;var i=o[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,r){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,o){"use strict";function r(t,e,o,r,i,n){if(o&&(this.char=o[r]),this.color=r,this.x=t,this.y=e,this.game=i,this.type=n,n){var a="knight"===n?"n":n.charAt(0);"W"===this.color&&(a=a.toUpperCase()),this.FENname=a}}function i(t,e,o,i){r.call(this,t,e,l.pawn,o,i,"pawn")}function n(t,e,o,i){r.call(this,t,e,l.rook,o,i,"rook")}function a(t,e,o,i){r.call(this,t,e,l.knight,o,i,"knight")}function u(t,e,o,i){r.call(this,t,e,l.bishop,o,i,"bishop")}function c(t,e,o,i){r.call(this,t,e,l.queen,o,i,"queen")}function s(t,e,o,i){r.call(this,t,e,l.king,o,i,"king")}Object.defineProperty(e,"__esModule",{value:!0});var l=e.PIECE_CHARS={pawn:{W:"♙",B:"♟"},rook:{W:"♖",B:"♜"},knight:{W:"♘",B:"♞"},bishop:{W:"♗",B:"♝"},queen:{W:"♕",B:"♛"},king:{W:"♔",B:"♚"}};r.empty=function(){return new r},r.prototype.getValidMoves=function(){return[{x:0,y:0},{x:7,y:7}]},i.prototype=r.empty(),i.prototype.getValidMoves=function(t){var e,o,r=[],i=this.y,n=this.x,a=this.game.turn,u=a.length,c=this.game.board,s="W"===this.color?i-1:i+1,l="W"===this.color?i-2:i+2,f=(this.color,[n-1,n+1]);s<8&&s>=0&&!c[s][n]&&(r.push({x:n,y:s}),(1==i||6==i)&&l<8&&l>=0&&!this.game.board[l][n]&&r.push({x:n,y:l}));for(var h=0;h<2;h++)o=f[h],s<8&&s>=0&&c[s][o]&&c[s][o].color!==this.color&&r.push({x:o,y:s});for(var h=0;h<2;h++)o=f[h],!(e=a[u-1])||e.to.x!==o||e.to.y!==i||e.color===this.color||1!==e.from.y&&6!==e.from.y||3!==i&&4!==i||r.push({x:o,y:s,movePiece:{piece:this.game.board[i][o],from:{x:o,y:i},to:null}});return t?game.simulateAndFilter(r,this):r},r.pawn=function(t,e,o,r){return new i(t,e,o,r)},n.prototype=r.empty(),n.prototype.getValidMoves=function(t){var e=[];[[-1,0],[1,0],[0,1],[0,-1]].forEach(function(t){var o,r,i,n;for(o=1;(r=this.x+t[0]*o,!(0>(i=this.y+t[1]*o)||i>7||0>r||r>7))&&(!(n=this.game.board[i][r])||n.color!==this.color)&&(e.push({x:r,y:i}),!n);o++);},this);return t?game.simulateAndFilter(e,this):e},r.rook=function(t,e,o,r){return new n(t,e,o,r)},a.prototype=r.empty(),a.prototype.getValidMoves=function(t){for(var e,o,r=[],i=[[2,1],[-2,1],[1,2],[-1,2],[2,-1],[-2,-1],[1,-2],[-1,-2]],n=0;n<i.length;n++){var a,u=!1;e=i[n][0],o=i[n][1],this.x+e<8&&this.x+e>=0&&this.y+o<8&&this.y+o>=0&&(a=this.game.board[this.y+o][this.x+e],u=!a||a.color!=this.color),u&&r.push({x:this.x+e,y:this.y+o})}return t?game.simulateAndFilter(r,this):r},r.knight=function(t,e,o,r){return new a(t,e,o,r)},u.prototype=r.empty(),u.prototype.getValidMoves=function(t){var e=[];[[-1,-1],[1,1],[-1,1],[1,-1]].forEach(function(t){var o,r,i,n;for(o=1;(r=this.x+t[0]*o,!(0>(i=this.y+t[1]*o)||i>7||0>r||r>7))&&(!(n=this.game.board[i][r])||n.color!==this.color)&&(e.push({x:r,y:i}),!n);o++);},this);return t?game.simulateAndFilter(e,this):e},r.bishop=function(t,e,o,r){return new u(t,e,o,r)},c.prototype=r.empty(),c.prototype.getValidMoves=function(t){var e=n.prototype.getValidMoves.call(this),o=u.prototype.getValidMoves.call(this),r=e.concat(o);return t?game.simulateAndFilter(r,this):r},r.queen=function(t,e,o,r){return new c(t,e,o,r)},s.prototype=r.empty(),s.prototype.getValidMoves=function(t){var e=[],o=[[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1],[-1,0],[1,0]],r=this.x,i=this.y,n=this.game,a=n.turn,u=(a.length,this);o.forEach(function(t){var o,a=r+t[0],c=i+t[1];a<8&&a>=0&&c<8&&c>=0&&((o=n.board[c][a])&&o.color==u.color||e.push({x:a,y:c}))}),a.some(function(t){return"king"===t.type&&t.color===u.color})||[[0,2,-1],[7,6,1]].forEach(function(t){var o=t[0],c=t[1],s=t[2],l=n.board[i][o];if(l&&"rook"!==!l.type&&!a.some(function(t){return t.from.x===o&&t.from.y===i})){for(var f=r+s;f!==o;f+=s){if(n.board[i][f])return;var h=!0;if(n.board.forEach(function(t){t.forEach(function(t){t&&"king"!==t.type&&t.color!==u.color&&t.getValidMoves().forEach(function(t){t&&t.y===i&&t.x===f&&(h=!1)})})}),!h)return}var p={x:c,y:i,movePiece:{piece:u.game.board[i][o],from:{x:o,y:i},to:{y:i,x:r+s}}};e.push(p)}});return t?n.simulateAndFilter(e,u):e},r.king=function(t,e,o,r){return new s(t,e,o,r)},e.Piece=r,e.Pawn=i,e.Rook=n,e.Knight=a,e.Bishop=u,e.Queen=c,e.King=s},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){for(var e=t.board,o=null,r=-9999,n=0;n<8;n++)for(var a=0;a<8;a++)e[n][a]&&e[n][a].getValidMoves().forEach(function(u,c){var s=e[n][a],l={x:s.x,y:s.y},f=e[u.y][u.x]?{piece:e[u.y][u.x],from:{x:u.x,y:u.y},to:null}:null;u.movePiece&&(f=u.movePiece),f&&t.simpleMovePiece(f.piece,f.from,f.to),t.simpleMovePiece(s,l,{x:u.x,y:u.y});var h=-i(e);h>r&&"B"===e[u.y][u.x].color&&(r=h,o={from:{x:a,y:n},to:u}),t.simpleMovePiece(s,{x:u.x,y:u.y},l),f&&t.simpleMovePiece(f.piece,f.to,f.from)});return o},i=function(t){for(var e=0,o=0;o<8;o++)for(var r=0;r<8;r++)e+=n(t[o][r]);return e},n=function(t){if(null===t)return 0;var e=function(t){if("pawn"===t.type)return 10;if("rook"===t.type)return 50;if("knight"===t.type)return 30;if("bishop"===t.type)return 30;if("queen"===t.type)return 90;if("king"===t.type)return 900;throw"Unknown piece: "+t.type}(t,t.color);return"W"===t.color?e:-e};e.default=r},function(t,e,o){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Graphics=e.AI=e.Piece=e.Game=void 0;var i=o(3),n=r(i),a=o(0),u=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}(a),c=o(1),s=r(c);e.Game=n.default,e.Piece=u,e.AI=s.default,e.Graphics="This feature is coming soon!"},function(t,e,o){"use strict";function r(t){this.board=[];for(var e=0;e<8;e++){for(var o=[],r=0;r<8;r++)o.push(null);this.board.push(o)}this.turn=[],this.FENboard=this.boardToFEN(),this.threefold=[]}Object.defineProperty(e,"__esModule",{value:!0});var i=o(0),n=o(1),a=function(t){return t&&t.__esModule?t:{default:t}}(n);r.prototype.piece=function(t,e,o,r){var n=i.Piece[t](e,o,r,this);this.board[o][e]=n},r.prototype.moveSelected=function(t,e,o,r,i,n){var u=e.x,c=e.y;if(t){var s={x:t.x,y:t.y};if(this.board[c][u]!=t){for(var l=t.getValidMoves(!n),f=null,h=0;h<l.length;h++){var p=l[h];if(p.x===u&&p.y===c){f=p;break}}if(!f)return!1;var y,d,v,m=f.movePiece;m&&(y=m.from,d=m.to,null===d?this.board[y.y][y.x]=null:(v=this.board[y.y][y.x],this.board[d.y][d.x]=v,v.x=d.x,v.y=d.y,this.board[y.y][y.x]=null));var x=this.board[c][u]?this.board[c][u]:null,m=m?f.movePiece:null;this.turn.push({from:s,to:e,color:t.color,type:t.type,piece:x,movePiece:m}),this.board[c][u]=t,this.board[t.y][t.x]=null,this.board[c][u].x=u,this.board[c][u].y=c,this.FENboard=this.boardToFEN(),this.threefold.push(this.FENboard),("pawn"===t.type||x)&&(this.threefold=[]),this.threefoldCheck()&&r("D"),this.halfmoveClock()>=50&&r("D"),"pawn"===t.type&&("W"===t.color&&0===c||"B"===t.color&&7===c)&&o&&(i||"B"!==t.color?o(t,u,c,t.color):this.promotePawn(t,u,c,t.color,"queen"));var g="W"===t.color?"B":"W",b=this.checkmate(g);if(b&&r(b),i){var P=(0,a.default)(this);this.moveSelected(this.board[P.from.y][P.from.x],P.to,o,r,!1,n)}}return t=null,!0}},r.prototype.promotePawn=function(t,e,o,r,i){this.piece(i,e,o,r)},r.prototype.simulateAndFilter=function(t,e){var o=[],r=this,i=(r.turn,this.board);return t.forEach(function(t,n){var a=t.y,u=t.x,c={x:e.x,y:e.y},s=i[a][u]?{piece:i[a][u],from:{x:u,y:a},to:null}:null;t.movePiece&&(s=t.movePiece),s&&r.simpleMovePiece(s.piece,s.from,s.to),r.simpleMovePiece(e,c,{x:u,y:a});var l=r.warning(e.color);r.simpleMovePiece(e,{x:u,y:a},c),s&&r.simpleMovePiece(s.piece,s.to,s.from),l||o.push(t)}),o},r.prototype.checkmate=function(t){for(var e=0;e<8;e++)for(var o=0;o<8;o++)if(this.board[e][o]&&this.board[e][o].color===t&&this.board[e][o].getValidMoves(!0).length)return!1;return this.warning(t)?t:"D"},r.prototype.simpleMovePiece=function(t,e,o){var r=this.board;o&&(r[o.y][o.x]=t,t.x=o.x,t.y=o.y),e&&(r[e.y][e.x]=null)},r.prototype.warning=function(t){var e,o=!1;return this.board.forEach(function(o){o.forEach(function(o){o&&o.color===t&&"king"===o.type&&(e=o)})}),this.board.forEach(function(r){r.forEach(function(r){r&&r.color!==t&&r.getValidMoves().forEach(function(t){t.x===e.x&&t.y===e.y&&(o=!0)})})}),o},r.prototype.threefoldCheck=function(){for(var t=this.threefold,e=t.length,o=0;o<e;o++){for(var r=0,i=o+1;i<e;i++)t[o]===t[i]&&(r+=1);if(r>=2)return!0}return!1},r.prototype.boardToFEN=function(){for(var t=this.board,e="",o=0,r=0;r<8;r++){for(var i=0;i<8;i++)t[r][i]?(o&&(e+=o),o=0,e+=t[r][i].FENname):o++;o&&(e+=o),o=0,e+=r<7?"/":""}return e},r.prototype.halfmoveClock=function(){var t=this.turn,e=t.length,o=0;if(0===t.length)return o;for(var r=t[e-1-o];o<=e-1&&"pawn"!==r.type&&!r.piece;)o++,r=t[e-1-o];return o},e.default=r}])});
//# sourceMappingURL=index.js.map