!function(t,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define("rsg-chess",[],o):"object"==typeof exports?exports["rsg-chess"]=o():t["rsg-chess"]=o()}("undefined"!=typeof self?self:this,function(){return function(t){function o(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}var e={};return o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},o.p="",o(o.s=4)}([function(t,o,e){"use strict";function r(t,o,e,r,i,n){if(e&&(this.char=e[r]),this.color=r,this.x=t,this.y=o,this.game=i,this.type=n,n){var c="knight"===n?"n":n.charAt(0);"W"===this.color&&(c=c.toUpperCase()),this.FENname=c}}function i(t,o,e,i){r.call(this,t,o,h.pawn,e,i,"pawn")}function n(t,o,e,i){r.call(this,t,o,h.rook,e,i,"rook")}function c(t,o,e,i){r.call(this,t,o,h.knight,e,i,"knight")}function a(t,o,e,i){r.call(this,t,o,h.bishop,e,i,"bishop")}function u(t,o,e,i){r.call(this,t,o,h.queen,e,i,"queen")}function s(t,o,e,i){r.call(this,t,o,h.king,e,i,"king")}Object.defineProperty(o,"__esModule",{value:!0});var h=o.PIECE_CHARS={pawn:{W:"♙",B:"♟"},rook:{W:"♖",B:"♜"},knight:{W:"♘",B:"♞"},bishop:{W:"♗",B:"♝"},queen:{W:"♕",B:"♛"},king:{W:"♔",B:"♚"}};r.empty=function(){return new r},r.prototype.getValidMoves=function(){return[{x:0,y:0},{x:7,y:7}]},i.prototype=r.empty(),i.prototype.getValidMoves=function(t){var o,e,r=this.game,i=[],n=this.y,c=this.x,a=r.turn,u=a.length,s=r.board,h="W"===this.color?n-1:n+1,f="W"===this.color?n-2:n+2,l=(this.color,[c-1,c+1]);h<8&&h>=0&&!s[h][c]&&(i.push({x:c,y:h}),(1==n||6==n)&&f<8&&f>=0&&!r.board[f][c]&&i.push({x:c,y:f}));for(var p=0;p<2;p++)e=l[p],h<8&&h>=0&&s[h][e]&&s[h][e].color!==this.color&&i.push({x:e,y:h});for(var p=0;p<2;p++)e=l[p],!(o=a[u-1])||o.to.x!==e||o.to.y!==n||o.color===this.color||1!==o.from.y&&6!==o.from.y||3!==n&&4!==n||i.push({x:e,y:h,movePiece:{piece:r.board[n][e],from:{x:e,y:n},to:null}});return t?r.simulateAndFilter(i,this):i},r.pawn=function(t,o,e,r){return new i(t,o,e,r)},n.prototype=r.empty(),n.prototype.getValidMoves=function(t){var o=this.game,e=[];[[-1,0],[1,0],[0,1],[0,-1]].forEach(function(t){var r,i,n,c;for(r=1;(i=this.x+t[0]*r,!(0>(n=this.y+t[1]*r)||n>7||0>i||i>7))&&(!(c=o.board[n][i])||c.color!==this.color)&&(e.push({x:i,y:n}),!c);r++);},this);return t?o.simulateAndFilter(e,this):e},r.rook=function(t,o,e,r){return new n(t,o,e,r)},c.prototype=r.empty(),c.prototype.getValidMoves=function(t){for(var o,e,r=this.game,i=[],n=[[2,1],[-2,1],[1,2],[-1,2],[2,-1],[-2,-1],[1,-2],[-1,-2]],c=0;c<n.length;c++){var a,u=!1;o=n[c][0],e=n[c][1],this.x+o<8&&this.x+o>=0&&this.y+e<8&&this.y+e>=0&&(a=r.board[this.y+e][this.x+o],u=!a||a.color!=this.color),u&&i.push({x:this.x+o,y:this.y+e})}return t?r.simulateAndFilter(i,this):i},r.knight=function(t,o,e,r){return new c(t,o,e,r)},a.prototype=r.empty(),a.prototype.getValidMoves=function(t){var o=this.game,e=[];[[-1,-1],[1,1],[-1,1],[1,-1]].forEach(function(t){var r,i,n,c;for(r=1;(i=this.x+t[0]*r,!(0>(n=this.y+t[1]*r)||n>7||0>i||i>7))&&(!(c=o.board[n][i])||c.color!==this.color)&&(e.push({x:i,y:n}),!c);r++);},this);return t?o.simulateAndFilter(e,this):e},r.bishop=function(t,o,e,r){return new a(t,o,e,r)},u.prototype=r.empty(),u.prototype.getValidMoves=function(t){var o=this.game,e=n.prototype.getValidMoves.call(this),r=a.prototype.getValidMoves.call(this),i=e.concat(r);return t?o.simulateAndFilter(i,this):i},r.queen=function(t,o,e,r){return new u(t,o,e,r)},s.prototype=r.empty(),s.prototype.getValidMoves=function(t){var o=[],e=[[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1],[-1,0],[1,0]],r=this.x,i=this.y,n=this.game,c=n.turn,a=(c.length,this);e.forEach(function(t){var e,c=r+t[0],u=i+t[1];c<8&&c>=0&&u<8&&u>=0&&((e=n.board[u][c])&&e.color==a.color||o.push({x:c,y:u}))}),c.some(function(t){return"king"===t.type&&t.color===a.color})||[[0,2,-1],[7,6,1]].forEach(function(t){var e=t[0],u=t[1],s=t[2],h=n.board[i][e];if(h&&"rook"!==!h.type&&!c.some(function(t){return t.from.x===e&&t.from.y===i})){for(var f=r+s;f!==e;f+=s){if(n.board[i][f])return;var l=!0;if(n.board.forEach(function(t){t.forEach(function(t){t&&"king"!==t.type&&t.color!==a.color&&t.getValidMoves().forEach(function(t){t&&t.y===i&&t.x===f&&(l=!1)})})}),!l)return}var p={x:u,y:i,movePiece:{piece:a.game.board[i][e],from:{x:e,y:i},to:{y:i,x:r+s}}};o.push(p)}});return t?n.simulateAndFilter(o,a):o},r.king=function(t,o,e,r){return new s(t,o,e,r)},o.Piece=r,o.Pawn=i,o.Rook=n,o.Knight=c,o.Bishop=a,o.Queen=u,o.King=s},function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){for(var o=t.board,e=null,r=-9999,n=0;n<8;n++)for(var c=0;c<8;c++)o[n][c]&&o[n][c].getValidMoves().forEach(function(a,u){var s=o[n][c],h={x:s.x,y:s.y},f=o[a.y][a.x]?{piece:o[a.y][a.x],from:{x:a.x,y:a.y},to:null}:null;a.movePiece&&(f=a.movePiece),f&&t.simpleMovePiece(f.piece,f.from,f.to),t.simpleMovePiece(s,h,{x:a.x,y:a.y});var l=-i(o);l>r&&"B"===o[a.y][a.x].color&&(r=l,e={from:{x:c,y:n},to:a}),t.simpleMovePiece(s,{x:a.x,y:a.y},h),f&&t.simpleMovePiece(f.piece,f.to,f.from)});return e},i=function(t){for(var o=0,e=0;e<8;e++)for(var r=0;r<8;r++)o+=n(t[e][r]);return o},n=function(t){if(null===t)return 0;var o=function(t){if("pawn"===t.type)return 10;if("rook"===t.type)return 50;if("knight"===t.type)return 30;if("bishop"===t.type)return 30;if("queen"===t.type)return 90;if("king"===t.type)return 900;throw"Unknown piece: "+t.type}(t,t.color);return"W"===t.color?o:-o};o.default=r},function(t,o,e){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(o,"__esModule",{value:!0}),o.Graphics=o.AI=o.Piece=o.Game=void 0;var i=e(3),n=r(i),c=e(0),a=function(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e]);return o.default=t,o}(c),u=e(1),s=r(u);o.Game=n.default,o.Piece=a,o.AI=s.default,o.Graphics="This feature is coming soon!"},function(t,o,e){"use strict";function r(t){this.board=[];for(var o=0;o<8;o++){for(var e=[],r=0;r<8;r++)e.push(null);this.board.push(e)}this.turn=[],this.FEN=[],this.FENboard=[],this.threefold=[]}Object.defineProperty(o,"__esModule",{value:!0});var i=e(0),n=e(1),c=function(t){return t&&t.__esModule?t:{default:t}}(n);r.prototype.piece=function(t,o,e,r){var n=i.Piece[t](o,e,r,this);this.board[e][o]=n,this.FEN=this.gameToFEN(),this.FENboard=this.boardToFEN()},r.prototype.moveSelected=function(t,o,e,r,i,n){var a=o.x,u=o.y;if(t){var s={x:t.x,y:t.y};if(this.board[u][a]!=t){for(var h=t.getValidMoves(!n),f=null,l=0;l<h.length;l++){var p=h[l];if(p.x===a&&p.y===u){f=p;break}}if(!f)return!1;var y,v,d,m=f.movePiece;m&&(y=m.from,v=m.to,null===v?this.board[y.y][y.x]=null:(d=this.board[y.y][y.x],this.board[v.y][v.x]=d,d.x=v.x,d.y=v.y,this.board[y.y][y.x]=null));var g=this.board[u][a]?this.board[u][a]:null,m=m?f.movePiece:null;this.turn.push({from:s,to:o,color:t.color,type:t.type,piece:g,movePiece:m}),this.board[u][a]=t,this.board[t.y][t.x]=null,this.board[u][a].x=a,this.board[u][a].y=u,this.FEN=this.gameToFEN(),this.FENboard=this.boardToFEN(),this.threefold.push(this.FENboard),("pawn"===t.type||g)&&(this.threefold=[]),this.threefoldCheck()&&r("D"),this.halfmoveClock()>=50&&r("D"),"pawn"===t.type&&("W"===t.color&&0===u||"B"===t.color&&7===u)&&e&&(i||"B"!==t.color?e(t,a,u,t.color):this.promotePawn(t,a,u,t.color,"queen"));var x="W"===t.color?"B":"W",b=this.checkmate(x);if(b&&r(b),i){var k=(0,c.default)(this);this.moveSelected(this.board[k.from.y][k.from.x],k.to,e,r,!1,n)}}return t=null,!0}},r.prototype.promotePawn=function(t,o,e,r,i){this.piece(i,o,e,r)},r.prototype.simulateAndFilter=function(t,o){var e=[],r=this,i=(r.turn,this.board);return t.forEach(function(t,n){var c=t.y,a=t.x,u={x:o.x,y:o.y},s=i[c][a]?{piece:i[c][a],from:{x:a,y:c},to:null}:null;t.movePiece&&(s=t.movePiece),s&&r.simpleMovePiece(s.piece,s.from,s.to),r.simpleMovePiece(o,u,{x:a,y:c});var h=r.warning(o.color);r.simpleMovePiece(o,{x:a,y:c},u),s&&r.simpleMovePiece(s.piece,s.to,s.from),h||e.push(t)}),e},r.prototype.checkmate=function(t){for(var o=0;o<8;o++)for(var e=0;e<8;e++)if(this.board[o][e]&&this.board[o][e].color===t&&this.board[o][e].getValidMoves(!0).length)return!1;return this.warning(t)?t:"D"},r.prototype.simpleMovePiece=function(t,o,e){var r=this.board;e&&(r[e.y][e.x]=t,t.x=e.x,t.y=e.y),o&&(r[o.y][o.x]=null)},r.prototype.warning=function(t){var o,e=!1;return this.board.forEach(function(e){e.forEach(function(e){e&&e.color===t&&"king"===e.type&&(o=e)})}),this.board.forEach(function(r){r.forEach(function(r){r&&r.color!==t&&r.getValidMoves().forEach(function(t){t.x===o.x&&t.y===o.y&&(e=!0)})})}),e},r.prototype.threefoldCheck=function(){for(var t=this.threefold,o=t.length,e=0;e<o;e++){for(var r=0,i=e+1;i<o;i++)t[e]===t[i]&&(r+=1);if(r>=2)return!0}return!1},r.prototype.pieceToAN=function(t,o){return"abcdefgh".charAt(t)+(8-o)},r.prototype.boardToFEN=function(){for(var t=this.board,o="",e=0,r=0;r<8;r++){for(var i=0;i<8;i++)t[r][i]?(e&&(o+=e),e=0,o+=t[r][i].FENname):e++;e&&(o+=e),e=0,o+=r<7?"/":""}return o},r.prototype.halfmoveClock=function(){var t=this.turn,o=t.length,e=0;if(0===t.length)return e;for(var r=t[o-1-e];e<=o-1&&"pawn"!==r.type&&!r.piece;)e++,r=t[o-1-e];return e},r.prototype.activeColour=function(){var t=this.turn;return t.length&&"W"===t[t.length-1].color?"b":"w"},r.prototype.castlingTarget=function(){var t,o,e=this.board,r=this.turn,i="";return r.forEach(function(e){t="king"===e.type&&"W"===e.color,o="king"===e.type&&"B"===e.color}),[[7,0],[0,0],[7,7],[0,7]].forEach(function(t){var o=t[0],n=t[1],c=e[n][o];if(c&&"rook"!==!c.type&&!r.some(function(t){return t.from.x===o&&t.from.y===n})){var a=0===o?"q":"k";i+=0===n?a.toUpperCase():a}}),i||(i="-"),i},r.prototype.enPassantTarget=function(){var t=this.turn,o="";if(t.length){var e=t[t.length-1];"W"===e.color&&4===e.to.y&&(o=this.pieceToAN(e.to.x,e.to.y+1)),"B"===e.color&&3===e.to.y&&(o=this.pieceToAN(e.to.x,e.to.y-1))}return o||(o="-"),o},r.prototype.fullmoveCount=function(){var t=1;return this.turn.forEach(function(o){"B"===o.color&&(t+=1)}),t},r.prototype.gameToFEN=function(){var t="";return t+=this.boardToFEN(),t+=" "+this.activeColour(),t+=" "+this.castlingTarget(),t+=" "+this.enPassantTarget(),t+=" "+this.halfmoveClock(),t+=" "+this.fullmoveCount()},r.prototype.initializeGame=function(){for(var t=new r,o=0;o<8;o++)t.piece("pawn",o,6,"W"),t.piece("pawn",o,1,"B");return t.piece("rook",0,0,"B"),t.piece("knight",1,0,"B"),t.piece("bishop",2,0,"B"),t.piece("queen",3,0,"B"),t.piece("king",4,0,"B"),t.piece("bishop",5,0,"B"),t.piece("knight",6,0,"B"),t.piece("rook",7,0,"B"),t.piece("rook",0,7,"W"),t.piece("knight",1,7,"W"),t.piece("bishop",2,7,"W"),t.piece("queen",3,7,"W"),t.piece("king",4,7,"W"),t.piece("bishop",5,7,"W"),t.piece("knight",6,7,"W"),t.piece("rook",7,7,"W"),t},o.default=r},function(t,o,e){"use strict";var r=e(2),i=r.Game.prototype.initializeGame();i.moveSelected(i.board[1][1],{y:2,x:1},function(){},function(){},!1,!1),i.moveSelected(i.board[7][1],{y:5,x:0},function(){},function(){},!1,!1),console.log(i.FEN)}])});
//# sourceMappingURL=test.js.map