!function(o,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rsg-chess",[],t):"object"==typeof exports?exports["rsg-chess"]=t():o["rsg-chess"]=t()}("undefined"!=typeof self?self:this,function(){return function(o){function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return o[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var e={};return t.m=o,t.c=e,t.d=function(o,e,r){t.o(o,e)||Object.defineProperty(o,e,{configurable:!1,enumerable:!0,get:r})},t.n=function(o){var e=o&&o.__esModule?function(){return o.default}:function(){return o};return t.d(e,"a",e),e},t.o=function(o,t){return Object.prototype.hasOwnProperty.call(o,t)},t.p="",t(t.s=4)}([function(o,t,e){"use strict";function r(o,t,e,r,i,n){if(e&&(this.char=e[r]),this.color=r,this.x=o,this.y=t,this.game=i,this.type=n,n){var a="knight"===n?"n":n.charAt(0);"W"===this.color&&(a=a.toUpperCase()),this.FENname=a}}function i(o,t,e,i){r.call(this,o,t,h.pawn,e,i,"pawn")}function n(o,t,e,i){r.call(this,o,t,h.rook,e,i,"rook")}function a(o,t,e,i){r.call(this,o,t,h.knight,e,i,"knight")}function c(o,t,e,i){r.call(this,o,t,h.bishop,e,i,"bishop")}function u(o,t,e,i){r.call(this,o,t,h.queen,e,i,"queen")}function s(o,t,e,i){r.call(this,o,t,h.king,e,i,"king")}Object.defineProperty(t,"__esModule",{value:!0});var h=t.PIECE_CHARS={pawn:{W:"♙",B:"♟"},rook:{W:"♖",B:"♜"},knight:{W:"♘",B:"♞"},bishop:{W:"♗",B:"♝"},queen:{W:"♕",B:"♛"},king:{W:"♔",B:"♚"}};r.empty=function(){return new r},r.prototype.getValidMoves=function(){return[{x:0,y:0},{x:7,y:7}]},i.prototype=r.empty(),i.prototype.getValidMoves=function(o){var t,e,r=this.game,i=[],n=this.y,a=this.x,c=r.board,u=r.turn,s=u.length,h="W"===this.color?n-1:n+1,p="W"===this.color?n-2:n+2,l=(this.color,[a-1,a+1]);h<8&&h>=0&&!c[h][a]&&(i.push({x:a,y:h}),(1===n||6===n)&&p<8&&p>=0&&!r.board[p][a]&&i.push({x:a,y:p}));for(var f=0;f<2;f++)e=l[f],h<8&&h>=0&&c[h][e]&&c[h][e].color!==this.color&&i.push({x:e,y:h});for(var y=0;y<2;y++)e=l[y],!(t=u[s-1])||"pawn"!==t.type||t.to.x!==e||t.to.y!==n||t.color===this.color||1!==t.from.y&&6!==t.from.y||3!==n&&4!==n||i.push({x:e,y:h,movePiece:{piece:r.board[n][e],from:{x:e,y:n},to:null}});return o?r.simulateAndFilter(i,this):i},r.pawn=function(o,t,e,r){return new i(o,t,e,r)},n.prototype=r.empty(),n.prototype.getValidMoves=function(o){var t=this.game,e=[];[[-1,0],[1,0],[0,1],[0,-1]].forEach(function(o){var r,i,n,a;for(r=1;(i=this.x+o[0]*r,!((n=this.y+o[1]*r)<0||n>7||i<0||i>7))&&(!(a=t.board[n][i])||a.color!==this.color)&&(e.push({x:i,y:n}),!a);r++);},this);return o?t.simulateAndFilter(e,this):e},r.rook=function(o,t,e,r){return new n(o,t,e,r)},a.prototype=r.empty(),a.prototype.getValidMoves=function(o){for(var t,e,r=this.game,i=[],n=[[2,1],[-2,1],[1,2],[-1,2],[2,-1],[-2,-1],[1,-2],[-1,-2]],a=0;a<n.length;a++){var c,u=!1;t=n[a][0],e=n[a][1],this.x+t<8&&this.x+t>=0&&this.y+e<8&&this.y+e>=0&&(c=r.board[this.y+e][this.x+t],u=!c||c.color!==this.color),u&&i.push({x:this.x+t,y:this.y+e})}return o?r.simulateAndFilter(i,this):i},r.knight=function(o,t,e,r){return new a(o,t,e,r)},c.prototype=r.empty(),c.prototype.getValidMoves=function(o){var t=this.game,e=[];[[-1,-1],[1,1],[-1,1],[1,-1]].forEach(function(o){var r,i,n,a;for(r=1;(i=this.x+o[0]*r,!((n=this.y+o[1]*r)<0||n>7||i<0||i>7))&&(!(a=t.board[n][i])||a.color!==this.color)&&(e.push({x:i,y:n}),!a);r++);},this);return o?t.simulateAndFilter(e,this):e},r.bishop=function(o,t,e,r){return new c(o,t,e,r)},u.prototype=r.empty(),u.prototype.getValidMoves=function(o){var t=this.game,e=n.prototype.getValidMoves.call(this),r=c.prototype.getValidMoves.call(this),i=e.concat(r);return o?t.simulateAndFilter(i,this):i},r.queen=function(o,t,e,r){return new u(o,t,e,r)},s.prototype=r.empty(),s.prototype.getValidMoves=function(o){var t=[],e=[[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1],[-1,0],[1,0]],r=this.x,i=this.y,n=this.game,a=n.turn,c=this;e.forEach(function(o){var e,a=r+o[0],u=i+o[1];a<8&&a>=0&&u<8&&u>=0&&((e=n.board[u][a])&&e.color===c.color||t.push({x:a,y:u}))}),a.some(function(o){return"king"===o.type&&o.color===c.color})||[[0,2,-1],[7,6,1]].forEach(function(o){var e=o[0],u=o[1],s=o[2],h=n.board[i][e];if(h&&"rook"!==!h.type&&!a.some(function(o){return o.from.x===e&&o.from.y===i})){for(var p=r+s;p!==e;p+=s){if(n.board[i][p])return;var l=!0;if(n.board.forEach(function(o){o.forEach(function(o){o&&"king"!==o.type&&o.color!==c.color&&o.getValidMoves().forEach(function(o){o&&o.y===i&&o.x===p&&(l=!1)})})}),!l)return}var f={x:u,y:i,movePiece:{piece:c.game.board[i][e],from:{x:e,y:i},to:{y:i,x:r+s}}};t.push(f)}});return o?n.simulateAndFilter(t,c):t},r.king=function(o,t,e,r){return new s(o,t,e,r)},t.Piece=r,t.Pawn=i,t.Rook=n,t.Knight=a,t.Bishop=c,t.Queen=u,t.King=s},function(o,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(o,t,e){for(var r,n=t.allMoves(),a=-9999,c=0;c<n.length;c++){var u=n[c],s=t.simpleMove(u),h=i(o-1,t,-1e4,1e4,!e);s(),h>=a&&(a=h,r=u)}return r},i=function o(t,e,r,i,a){if(0===t)return-n(e.board);var c=e.allMoves();if(a){for(var u=-9999,s=0;s<c.length;s++){var h=e.simpleMove(c[s]);if(u=Math.max(u,o(t-1,e,r,i,!a)),h(),r=Math.max(r,u),i<=r)return u}return u}for(var p=9999,l=0;l<c.length;l++){var f=e.simpleMove(c[l]);if(p=Math.min(p,o(t-1,e,r,i,!a)),f(),(i=Math.min(i,p))<=r)return p}return p},n=function(o){for(var t=0,e=0;e<8;e++)for(var r=0;r<8;r++)t+=a(o[e][r]);return t},a=function(o){if(null===o)return 0;var t=function(o){return"pawn"===o.type?10:"rook"===o.type?50:"knight"===o.type?30:"bishop"===o.type?30:"queen"===o.type?90:"king"===o.type?900:void 0}(o,o.color);return"W"===o.color?t:-t};t.default=r},function(o,t,e){"use strict";function r(o){return o&&o.__esModule?o:{default:o}}Object.defineProperty(t,"__esModule",{value:!0}),t.Graphics=t.AI=t.Piece=t.Game=void 0;var i=e(3),n=r(i),a=e(0),c=function(o){if(o&&o.__esModule)return o;var t={};if(null!=o)for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e]);return t.default=o,t}(a),u=e(1),s=r(u);t.Game=n.default,t.Piece=c,t.AI=s.default,t.Graphics="This feature is coming soon!"},function(o,t,e){"use strict";function r(o){this.board=[];for(var t=0;t<8;t++){for(var e=[],r=0;r<8;r++)e.push(null);this.board.push(e)}this.turn=[],this.FEN=[],this.FENboard=[],this.threefold=[]}Object.defineProperty(t,"__esModule",{value:!0});var i=e(0),n=e(1),a=function(o){return o&&o.__esModule?o:{default:o}}(n);r.prototype.piece=function(o,t,e,r){var n=i.Piece[o](t,e,r,this);this.board[e][t]=n,this.FEN=this.gameToFEN(),this.FENboard=this.boardToFEN()},r.prototype.moveSelected=function(o,t,e,r,i,n,c){var u=t.x,s=t.y;if(o){var h={x:o.x,y:o.y};if(this.board[s][u]!==o){for(var p=o.getValidMoves(!c),l=null,f=0;f<p.length;f++){var y=p[f];if(y.x===u&&y.y===s){l=y;break}}if(!l)return!1;var v,d,m,x=l.movePiece;x&&(v=x.from,d=x.to,null===d?this.board[v.y][v.x]=null:(m=this.board[v.y][v.x],this.board[d.y][d.x]=m,m.x=d.x,m.y=d.y,this.board[v.y][v.x]=null));var g=this.board[s][u]?this.board[s][u]:null;x=x?l.movePiece:null,this.turn.push({from:h,to:t,color:o.color,type:o.type,piece:g,movePiece:x}),this.board[s][u]=o,this.board[o.y][o.x]=null,this.board[s][u].x=u,this.board[s][u].y=s,this.FEN=this.gameToFEN(),this.FENboard=this.boardToFEN(),this.threefold.push(this.FENboard),("pawn"===o.type||g)&&(this.threefold=[]),this.threefoldCheck()&&r("D"),this.halfmoveClock()>=50&&r("D"),"pawn"===o.type&&("W"===o.color&&0===s||"B"===o.color&&7===s)&&e&&(!i&&n&&"B"===o.color?this.promotePawn(o,u,s,o.color,"queen"):e(o,u,s,o.color));var b="W"===o.color?"B":"W",k=this.checkmate(b);if(k&&r(k),i){var M=(0,a.default)(i.depth,this,!1);this.moveSelected(this.board[M.from.y][M.from.x],M.to,e,r,!1,!0,c)}}return o=null,!0}},r.prototype.promotePawn=function(o,t,e,r,i){this.piece(i,t,e,r)},r.prototype.simulateAndFilter=function(o,t){var e=[],r=this,i=this.board;return o.forEach(function(o,n){var a=o.y,c=o.x,u={x:t.x,y:t.y},s=i[a][c]?{piece:i[a][c],from:{x:c,y:a},to:null}:null;o.movePiece&&(s=o.movePiece),s&&r.simpleMovePiece(s.piece,s.from,s.to),r.simpleMovePiece(t,u,{x:c,y:a});var h=r.warning(t.color);r.simpleMovePiece(t,{x:c,y:a},u),s&&r.simpleMovePiece(s.piece,s.to,s.from),h||e.push(o)}),e},r.prototype.checkmate=function(o){for(var t=0;t<8;t++)for(var e=0;e<8;e++)if(this.board[t][e]&&this.board[t][e].color===o&&this.board[t][e].getValidMoves(!0).length)return!1;return this.warning(o)?o:"D"},r.prototype.simpleMovePiece=function(o,t,e){var r=this.board;e&&(r[e.y][e.x]=o,o.x=e.x,o.y=e.y),t&&(r[t.y][t.x]=null)},r.prototype.simpleMove=function(o){var t=this,e=t.board,r=o.from,i=o.to,n=e[r.y][r.x],a=this.board[i.y][i.x]?this.board[i.y][i.x]:null,c=e[i.y][i.x]?{piece:e[i.y][i.x],from:{x:i.x,y:i.y},to:null}:null;return this.turn.push({from:r,to:{x:i.x,y:i.y},color:o.color,type:n.type,piece:a,movePiece:c}),i.movePiece&&(c=i.movePiece),c&&t.simpleMovePiece(c.piece,c.from,c.to),t.simpleMovePiece(n,r,{x:i.x,y:i.y}),function(){c&&t.simpleMovePiece(c.piece,c.to,c.from),t.simpleMovePiece(n,{x:i.x,y:i.y},r),a&&(e[i.y][i.x]=a),t.turn.pop()}},r.prototype.warning=function(o){var t,e=!1;return this.board.forEach(function(e){e.forEach(function(e){e&&e.color===o&&"king"===e.type&&(t=e)})}),this.board.forEach(function(r){r.forEach(function(r){r&&r.color!==o&&r.getValidMoves().forEach(function(o){o.x===t.x&&o.y===t.y&&(e=!0)})})}),e},r.prototype.threefoldCheck=function(){for(var o=this.threefold,t=o.length,e=0;e<t;e++){for(var r=0,i=e+1;i<t;i++)o[e]===o[i]&&(r+=1);if(r>=2)return!0}return!1},r.prototype.pieceToAN=function(o,t){return"abcdefgh".charAt(o)+(8-t)},r.prototype.boardToFEN=function(){for(var o=this.board,t="",e=0,r=0;r<8;r++){for(var i=0;i<8;i++)o[r][i]?(e&&(t+=e),e=0,t+=o[r][i].FENname):e++;e&&(t+=e),e=0,t+=r<7?"/":""}return t},r.prototype.halfmoveClock=function(){var o=this.turn,t=o.length,e=0;if(0===o.length)return e;for(var r=o[t-1-e];e<=t-1&&"pawn"!==r.type&&!r.piece;)e++,r=o[t-1-e];return e},r.prototype.activeColour=function(){var o=this.turn;return o.length&&"W"===o[o.length-1].color?"b":"w"},r.prototype.castlingTarget=function(){var o,t,e=this.board,r=this.turn,i="";return r.forEach(function(e){o="king"===e.type&&"W"===e.color,t="king"===e.type&&"B"===e.color}),[[7,0],[0,0],[7,7],[0,7]].forEach(function(n){var a=n[0],c=n[1],u=e[c][a];if((7!==c||!o)&&(0!==c||!t)&&u&&"rook"!==!u.type&&!r.some(function(o){return"rook"===o.type&&(o.from.x===a&&o.from.y===c)})){var s=0===a?"q":"k";i+=0===c?s.toUpperCase():s}}),i||(i="-"),i},r.prototype.enPassantTarget=function(){var o=this.turn,t="";if(o.length){var e=o[o.length-1];"W"===e.color&&4===e.to.y&&(t=this.pieceToAN(e.to.x,e.to.y+1)),"B"===e.color&&3===e.to.y&&(t=this.pieceToAN(e.to.x,e.to.y-1))}return t||(t="-"),t},r.prototype.fullmoveCount=function(){var o=1;return this.turn.forEach(function(t){"B"===t.color&&(o+=1)}),o},r.prototype.gameToFEN=function(){var o="";return o+=this.boardToFEN(),o+=" "+this.activeColour(),o+=" "+this.castlingTarget(),o+=" "+this.enPassantTarget(),o+=" "+this.halfmoveClock(),o+=" "+this.fullmoveCount()},r.prototype.initializeGame=function(){for(var o=new r,t=0;t<8;t++)o.piece("pawn",t,6,"W"),o.piece("pawn",t,1,"B");return o.piece("rook",0,0,"B"),o.piece("knight",1,0,"B"),o.piece("bishop",2,0,"B"),o.piece("queen",3,0,"B"),o.piece("king",4,0,"B"),o.piece("bishop",5,0,"B"),o.piece("knight",6,0,"B"),o.piece("rook",7,0,"B"),o.piece("rook",0,7,"W"),o.piece("knight",1,7,"W"),o.piece("bishop",2,7,"W"),o.piece("queen",3,7,"W"),o.piece("king",4,7,"W"),o.piece("bishop",5,7,"W"),o.piece("knight",6,7,"W"),o.piece("rook",7,7,"W"),o},r.prototype.allMoves=function(){for(var o=this.board,t=[],e=this.activeColour().toUpperCase(),r=0;r<8;r++)for(var i=0;i<8;i++)if(o[r][i]&&o[r][i].color===e){var n=o[r][i].getValidMoves();n.forEach(function(e){t.push({color:o[r][i].color,from:{x:i,y:r},to:e,FENname:o[r][i].FENname})})}return t},t.default=r},function(o,t,e){"use strict";var r=e(2),i=r.Game.prototype.initializeGame();i.moveSelected(i.board[6][0],{y:5,x:0},function(){},function(){},!1,!1);var n=new r.AI(5,i,!0);console.log(n)}])});
//# sourceMappingURL=test.js.map