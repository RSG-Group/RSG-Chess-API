{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 04877e31603f3e38b462","webpack:///./src/game.js","webpack:///./src/pieces.js","webpack:///./src/AI.js","webpack:///./src/index.js","webpack:///./test/index.js"],"names":["Game","promoCallback","board","i","arrayIn","j","push","turn","FEN","FENboard","threefold","prototype","piece","type","x","y","color","gameToFEN","boardToFEN","moveSelected","selected","to","promotionCallback","checkmateCallback","playAgainstAI","simulate","from","validMoves","getValidMoves","validMove","length","vm","movePiece","take","paste","rook","threefoldCheck","halfmoveClock","comingAI","customAIPromotion","promotePawn","checkmateColor","checkmateValue","checkmate","move","customAIMovement","bestMove","depth","pawn","simulateAndFilter","moves","self","forEach","simpleMovePiece","warning","simpleMove","capturedPiece","pop","result","king","yyy","xxx","mmm","count","pieceToAN","xChars","charAt","missingPieces","FENname","ev","activeColour","activeColor","castlingTarget","possibleCastling","whiteKingMoved","blackKingMoved","props","rookX","rookY","some","castlingSide","toUpperCase","enPassantTarget","fullmoveCount","initializeGame","defaultGame","allMoves","PIECE_CHARS","W","B","knight","bishop","queen","Piece","charBase","game","char","empty","Pawn","call","last","turnTo","turnFrom","figX","passantLast","passantFig","colorY","colorY2","passantY2","figXArray","Rook","coef","index","Knight","coordinates","one","two","help","boardPiece","Bishop","Queen","rookMoves","bishopMoves","concat","King","coord","xx","yy","kingMoved","newKingX","dir","safe","evv","evMove","rochade","ChessAI","gameState","isMaximisingPlayer","currentCell","bestValue","newGameMove","undo","boradValue","minimax","alpha","beta","evaluateBoard","Math","max","min","totalEvaluation","getPieceValue","getAbsoluteValue","absoluteValue","Pieces","AI","bestAI","console","log"],"mappings":"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","file":"test.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"rsg-chess\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rsg-chess\"] = factory();\n\telse\n\t\troot[\"rsg-chess\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 04877e31603f3e38b462","import { Piece } from './pieces.js'\r\nimport ChessAI from './AI.js'\r\n\r\nfunction Game (promoCallback) {\r\n  // the game board\r\n  this.board = []\r\n  // fill the board\r\n  for (var i = 0; i < 8; i++) {\r\n    var arrayIn = []\r\n    for (var j = 0; j < 8; j++) {\r\n      arrayIn.push(null)\r\n    }\r\n    this.board.push(arrayIn)\r\n  }\r\n\r\n  // the history of all turns\r\n  this.turn = []\r\n  // the current FEN status\r\n  this.FEN = []\r\n  // the current game configuration as FEN\r\n  this.FENboard = []\r\n  // the history of all game configurations displayed using FEN\r\n  this.threefold = []\r\n}\r\n\r\nGame.prototype.piece = function (type, x, y, color) {\r\n  var piece = Piece[type](x, y, color, this)\r\n  this.board[y][x] = piece\r\n\r\n  this.FEN = this.gameToFEN()\r\n  this.FENboard = this.boardToFEN()\r\n}\r\n\r\nGame.prototype.moveSelected = function (\r\n  selected, to, promotionCallback, checkmateCallback, playAgainstAI, simulate\r\n) {\r\n  var x = to.x\r\n  var y = to.y\r\n\r\n  if (selected) {\r\n    var from = { x: selected.x, y: selected.y }\r\n\r\n    if (this.board[y][x] !== selected) {\r\n      var validMoves = selected.getValidMoves(!simulate)\r\n      var validMove = null\r\n\r\n      for (var i = 0; i < validMoves.length; i++) {\r\n        var vm = validMoves[i]\r\n        if (vm.x === x && vm.y === y) {\r\n          validMove = vm\r\n          break\r\n        }\r\n      }\r\n\r\n      if (!validMove) return false\r\n      var movePiece = validMove.movePiece\r\n      var take, paste, rook\r\n      if (movePiece) {\r\n        take = movePiece.from\r\n        paste = movePiece.to\r\n        if (paste === null) {\r\n          this.board[take.y][take.x] = null\r\n        } else {\r\n          rook = this.board[take.y][take.x]\r\n          this.board[paste.y][paste.x] = rook\r\n          rook.x = paste.x\r\n          rook.y = paste.y\r\n          this.board[take.y][take.x] = null\r\n        }\r\n      }\r\n\r\n      var piece = this.board[y][x] ? this.board[y][x] : null\r\n      movePiece = (movePiece ? validMove.movePiece : null)\r\n      this.turn.push({\r\n        from: from,\r\n        to: to,\r\n        color: selected.color,\r\n        type: selected.type,\r\n        piece: piece,\r\n        movePiece: movePiece\r\n      })\r\n\r\n      this.board[y][x] = selected\r\n      this.board[selected.y][selected.x] = null\r\n      this.board[y][x].x = x\r\n      this.board[y][x].y = y\r\n\r\n      this.FEN = this.gameToFEN()\r\n      this.FENboard = this.boardToFEN()\r\n      // check for threefold repetition\r\n\r\n      this.threefold.push(this.FENboard)\r\n      if (selected.type === 'pawn' || piece) this.threefold = []\r\n      if (this.threefoldCheck()) checkmateCallback('D')\r\n\r\n      // check for the fifty-move rule\r\n      if (this.halfmoveClock() >= 50) checkmateCallback('D')\r\n\r\n      // check for pawn promotion\r\n      if (selected.type === 'pawn') {\r\n        if ((selected.color === 'W' && y === 0) || (selected.color === 'B' && y === 7)) {\r\n          if (promotionCallback) {\r\n            if (!playAgainstAI && playAgainstAI.comingAI && selected.color === 'B') {\r\n              playAgainstAI.customAIPromotion\r\n                ? playAgainstAI.customAIPromotion()\r\n                : this.promotePawn(selected, x, y, selected.color, 'queen')\r\n            } else {\r\n              promotionCallback(selected, x, y, selected.color)\r\n            }\r\n          }\r\n        }\r\n      };\r\n\r\n      var checkmateColor = selected.color === 'W' ? 'B' : 'W'\r\n      var checkmateValue = this.checkmate(checkmateColor)\r\n      if (checkmateValue) checkmateCallback(checkmateValue)\r\n\r\n      // Play AI\r\n      if (playAgainstAI && playAgainstAI.move) {\r\n        if (playAgainstAI.customAIMovement) {\r\n          playAgainstAI.customAIMovement()\r\n        } else {\r\n          var bestMove = ChessAI(playAgainstAI.depth, this, false)\r\n          this.moveSelected(\r\n            this.board[bestMove.from.y][bestMove.from.x],\r\n            bestMove.to,\r\n            promotionCallback,\r\n            checkmateCallback,\r\n            false,\r\n            true,\r\n            simulate\r\n          )\r\n        }\r\n      }\r\n      // end\r\n    }\r\n    selected = null\r\n    return true\r\n  }\r\n}\r\n\r\nGame.prototype.promotePawn = function (pawn, x, y, color, type) {\r\n  this.piece(type, x, y, color)\r\n}\r\n\r\nGame.prototype.simulateAndFilter = function (moves, piece) {\r\n  var validMoves = []\r\n  var self = this\r\n  var board = this.board\r\n\r\n  moves.forEach(function (move, i) {\r\n    var y = move.y\r\n    var x = move.x\r\n    var from = { x: piece.x, y: piece.y }\r\n    var movePiece = board[y][x] ? {\r\n      piece: board[y][x],\r\n      from: { x: x, y: y },\r\n      to: null\r\n    } : null\r\n\r\n    if (move.movePiece) movePiece = move.movePiece\r\n    if (movePiece) self.simpleMovePiece(movePiece.piece, movePiece.from, movePiece.to)\r\n\r\n    self.simpleMovePiece(piece, from, { x: x, y: y })\r\n    var warning = self.warning(piece.color)\r\n\r\n    // Return king\r\n    self.simpleMovePiece(piece, { x: x, y: y }, from)\r\n\r\n    // return the movePiece with simpleMovePiece() method\r\n    if (movePiece) self.simpleMovePiece(movePiece.piece, movePiece.to, movePiece.from)\r\n\r\n    if (!warning) validMoves.push(move)\r\n  })\r\n  return validMoves\r\n}\r\n\r\nGame.prototype.checkmate = function (color) {\r\n  // using let will allow us to make the code a bit simpler\r\n  for (let i = 0; i < 8; i++) {\r\n    for (let j = 0; j < 8; j++) {\r\n      if (\r\n        this.board[i][j] &&\r\n        this.board[i][j].color === color &&\r\n        this.board[i][j].getValidMoves(true).length\r\n      ) return false\r\n    }\r\n  }\r\n  if (this.warning(color)) return color\r\n  return 'D'\r\n}\r\n\r\nGame.prototype.simpleMovePiece = function (piece, from, to) {\r\n  var board = this.board\r\n  if (to) {\r\n    board[to.y][to.x] = piece\r\n    piece.x = to.x\r\n    piece.y = to.y\r\n  }\r\n  if (from) board[from.y][from.x] = null\r\n}\r\n\r\nGame.prototype.simpleMove = function (move) {\r\n  var self = this\r\n  var board = self.board\r\n  var from = move.from\r\n  var to = move.to\r\n  var piece = board[from.y][from.x]\r\n  var capturedPiece = this.board[to.y][to.x] ? this.board[to.y][to.x] : null\r\n  var movePiece = board[to.y][to.x] ? {\r\n    piece: board[to.y][to.x],\r\n    from: { x: to.x, y: to.y },\r\n    to: null\r\n  } : null\r\n\r\n  this.turn.push({\r\n    from: from,\r\n    to: { x: to.x, y: to.y },\r\n    color: move.color,\r\n    type: piece.type,\r\n    piece: capturedPiece,\r\n    movePiece: movePiece\r\n  })\r\n\r\n  if (to.movePiece) movePiece = to.movePiece\r\n  if (movePiece) self.simpleMovePiece(movePiece.piece, movePiece.from, movePiece.to)\r\n  self.simpleMovePiece(piece, from, { x: to.x, y: to.y })\r\n\r\n  return function () {\r\n    // return the current move /ev/\r\n    if (movePiece) self.simpleMovePiece(movePiece.piece, movePiece.to, movePiece.from)\r\n    self.simpleMovePiece(piece, { x: to.x, y: to.y }, from)\r\n    if (capturedPiece) board[to.y][to.x] = capturedPiece\r\n    self.turn.pop()\r\n  }\r\n}\r\n\r\nGame.prototype.warning = function (color) {\r\n  var result = false\r\n  var king\r\n\r\n  this.board.forEach(function (yyy) {\r\n    yyy.forEach(function (xxx) {\r\n      if (xxx && xxx.color === color && xxx.type === 'king') {\r\n        king = xxx\r\n      }\r\n    })\r\n  })\r\n\r\n  this.board.forEach(function (yyy) {\r\n    yyy.forEach(function (xxx) {\r\n      if (xxx && xxx.color !== color) {\r\n        xxx.getValidMoves().forEach(function (mmm) {\r\n          if (mmm.x === king.x && mmm.y === king.y) result = true\r\n        })\r\n      }\r\n    })\r\n  })\r\n  return result\r\n}\r\n\r\nGame.prototype.threefoldCheck = function () {\r\n  var threefold = this.threefold\r\n  var length = threefold.length\r\n\r\n  for (var i = 0; i < length; i++) {\r\n    // using let will allow us to make the code simpler\r\n    let count = 0\r\n    for (var j = i + 1; j < length; j++) {\r\n      if (threefold[i] === threefold[j]) count += 1\r\n    }\r\n    if (count >= 2) return true\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nGame.prototype.pieceToAN = function (x, y) {\r\n  var xChars = 'abcdefgh'\r\n  return xChars.charAt(x) + (8 - y)\r\n}\r\n\r\n// Support FEN functions in the API\r\nGame.prototype.boardToFEN = function () {\r\n  var board = this.board\r\n\r\n  // Convert the board configuration into FEN\r\n  var FENboard = ''\r\n  var missingPieces = 0\r\n  for (var i = 0; i < 8; i++) {\r\n    for (var j = 0; j < 8; j++) {\r\n      if (board[i][j]) {\r\n        if (missingPieces) FENboard += missingPieces\r\n        missingPieces = 0\r\n        FENboard += board[i][j].FENname\r\n      } else {\r\n        missingPieces++\r\n      }\r\n    }\r\n    if (missingPieces) FENboard += missingPieces\r\n    missingPieces = 0\r\n    FENboard += i < 7 ? '/' : ''\r\n  }\r\n\r\n  return FENboard\r\n}\r\n\r\nGame.prototype.halfmoveClock = function () {\r\n  var turn = this.turn\r\n  var length = turn.length\r\n  var count = 0\r\n  if (turn.length === 0) return count\r\n\r\n  var ev = turn[(length - 1) - count]\r\n  while (count <= length - 1 && ev.type !== 'pawn' && !ev.piece) {\r\n    count++\r\n    ev = turn[(length - 1) - count]\r\n  }\r\n\r\n  return count\r\n}\r\n\r\nGame.prototype.activeColour = function () {\r\n  var turn = this.turn\r\n  var activeColor =\r\n    turn.length &&\r\n    turn[turn.length - 1].color === 'W' ? 'b' : 'w'\r\n\r\n  return activeColor\r\n}\r\n\r\nGame.prototype.castlingTarget = function () {\r\n  var board = this.board\r\n  var turn = this.turn\r\n  var possibleCastling = ''\r\n\r\n  var whiteKingMoved\r\n  var blackKingMoved\r\n  turn.forEach(function (turn) {\r\n    whiteKingMoved = turn.type === 'king' && turn.color === 'W'\r\n    blackKingMoved = turn.type === 'king' && turn.color === 'B'\r\n  });\r\n\r\n  [[7, 0], [0, 0], [7, 7], [0, 7]].forEach(function (props) {\r\n    var rookX = props[0]\r\n    var rookY = props[1]\r\n    var rook = board[rookY][rookX]\r\n\r\n    if (rookY === 7 && whiteKingMoved) return\r\n    if (rookY === 0 && blackKingMoved) return\r\n\r\n    // Check rook on position\r\n    if (!rook || !rook.type === 'rook') return\r\n\r\n    // Check rook hasn't moved\r\n    if (turn.some(function (ev) {\r\n      if (ev.type !== 'rook') return false\r\n      return ev.from.x === rookX && ev.from.y === rookY\r\n    })) return\r\n\r\n    var castlingSide = rookX === 0 ? 'q' : 'k'\r\n    possibleCastling += rookY === 0 ? castlingSide.toUpperCase() : castlingSide\r\n  })\r\n\r\n  if (!possibleCastling) possibleCastling = '-'\r\n  return possibleCastling\r\n}\r\n\r\nGame.prototype.enPassantTarget = function () {\r\n  var turn = this.turn\r\n  var enPassantTarget = ''\r\n\r\n  if (turn.length) {\r\n    var ev = turn[turn.length - 1]\r\n    if (ev.color === 'W' && ev.to.y === 4) {\r\n      enPassantTarget = this.pieceToAN(ev.to.x, ev.to.y + 1)\r\n    }\r\n\r\n    if (ev.color === 'B' && ev.to.y === 3) {\r\n      enPassantTarget = this.pieceToAN(ev.to.x, ev.to.y - 1)\r\n    }\r\n  }\r\n\r\n  if (!enPassantTarget) enPassantTarget = '-'\r\n  return enPassantTarget\r\n}\r\n\r\nGame.prototype.fullmoveCount = function () {\r\n  var count = 1\r\n  this.turn.forEach(function (ev) {\r\n    if (ev.color === 'B') count += 1\r\n  })\r\n\r\n  return count\r\n}\r\n\r\nGame.prototype.gameToFEN = function () {\r\n  var FEN = ''\r\n\r\n  // Check the board configuration\r\n  FEN += this.boardToFEN()\r\n\r\n  // Find the active colour\r\n  FEN += ' ' + this.activeColour()\r\n\r\n  // Check castling availability\r\n  FEN += ' ' + this.castlingTarget()\r\n\r\n  // Check the En-passant target\r\n  FEN += ' ' + this.enPassantTarget()\r\n\r\n  // Add the halfmove clock\r\n  FEN += ' ' + this.halfmoveClock()\r\n\r\n  // Add the fullmove number\r\n  FEN += ' ' + this.fullmoveCount()\r\n\r\n  /*\r\n    More information about the FEN notation:\r\n    https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation\r\n    https://chessprogramming.wikispaces.com/Forsyth-Edwards+Notation\r\n  */\r\n\r\n  return FEN\r\n}\r\n\r\n// Set up default game configuration\r\nGame.prototype.initializeGame = function () {\r\n  var defaultGame = new Game()\r\n\r\n  // Pawns:\r\n  for (var i = 0; i < 8; i++) {\r\n    defaultGame.piece('pawn', i, 6, 'W')\r\n    defaultGame.piece('pawn', i, 1, 'B')\r\n  }\r\n\r\n  // Black figs:\r\n  defaultGame.piece('rook', 0, 0, 'B')\r\n  defaultGame.piece('knight', 1, 0, 'B')\r\n  defaultGame.piece('bishop', 2, 0, 'B')\r\n  defaultGame.piece('queen', 3, 0, 'B')\r\n  defaultGame.piece('king', 4, 0, 'B')\r\n  defaultGame.piece('bishop', 5, 0, 'B')\r\n  defaultGame.piece('knight', 6, 0, 'B')\r\n  defaultGame.piece('rook', 7, 0, 'B')\r\n\r\n  // White figs:\r\n  defaultGame.piece('rook', 0, 7, 'W')\r\n  defaultGame.piece('knight', 1, 7, 'W')\r\n  defaultGame.piece('bishop', 2, 7, 'W')\r\n  defaultGame.piece('queen', 3, 7, 'W')\r\n  defaultGame.piece('king', 4, 7, 'W')\r\n  defaultGame.piece('bishop', 5, 7, 'W')\r\n  defaultGame.piece('knight', 6, 7, 'W')\r\n  defaultGame.piece('rook', 7, 7, 'W')\r\n\r\n  return defaultGame\r\n}\r\n\r\nGame.prototype.allMoves = function () {\r\n  var board = this.board\r\n  var allMoves = []\r\n  var activeColour = this.activeColour().toUpperCase()\r\n\r\n  for (var i = 0; i < 8; i++) {\r\n    for (var j = 0; j < 8; j++) {\r\n      if (board[i][j] && board[i][j].color === activeColour) {\r\n        var validMoves = board[i][j].getValidMoves(true)\r\n        validMoves.forEach(function (ev) {\r\n          allMoves.push({\r\n            color: board[i][j].color,\r\n            from: {x: j, y: i},\r\n            to: ev,\r\n            FENname: board[i][j].FENname\r\n          })\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  return allMoves\r\n}\r\n\r\nexport default Game\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/game.js","//\r\n// RSG Chess\r\n// Licensed under Apache 2.0 LICENSE\r\n\r\nexport var PIECE_CHARS = {\r\n  pawn: { W: '♙', B: '♟' },\r\n  rook: { W: '♖', B: '♜' },\r\n  knight: { W: '♘', B: '♞' },\r\n  bishop: { W: '♗', B: '♝' },\r\n  queen: { W: '♕', B: '♛' },\r\n  king: { W: '♔', B: '♚' }\r\n}\r\n\r\nfunction Piece (x, y, charBase, color, game, type) {\r\n  if (charBase) this.char = charBase[color]\r\n  this.color = color\r\n  this.x = x\r\n  this.y = y\r\n  this.game = game\r\n  this.type = type\r\n  if (type) {\r\n    var FENname = type === 'knight' ? 'n' : type.charAt(0)\r\n    if (this.color === 'W') FENname = FENname.toUpperCase()\r\n    this.FENname = FENname\r\n  }\r\n}\r\n\r\nPiece.empty = function () {\r\n  return new Piece()\r\n}\r\n\r\nPiece.prototype.getValidMoves = function () {\r\n  return [\r\n    {x: 0, y: 0},\r\n    {x: 7, y: 7}\r\n  ]\r\n}\r\n\r\nfunction Pawn (x, y, color, game) {\r\n  Piece.call(this, x, y, PIECE_CHARS.pawn, color, game, 'pawn')\r\n}\r\n\r\nPawn.prototype = Piece.empty()\r\nPawn.prototype.getValidMoves = function (simulate) {\r\n  var game = this.game\r\n  var moves = []\r\n  /* eslint-disable */\r\n  var y = this.y, x = this.x\r\n  var board = game.board, turn = game.turn, length = turn.length\r\n  var last, turnTo, turnFrom, figX, passantLast, passantFig\r\n  var colorY = this.color === 'W' ? y - 1 : y + 1  \r\n  var colorY2 = this.color === 'W' ? y - 2 : y + 2  \r\n  var passantY2 = this.color === 'W' ? 3 : 4  \r\n  var figXArray = [x - 1, x + 1]\r\n  /* eslint-enable */\r\n\r\n  if (colorY < 8 && colorY >= 0 && !board[colorY][x]) {\r\n    moves.push({x: x, y: colorY})\r\n    if ((y === 1 || y === 6) && colorY2 < 8 && colorY2 >= 0 && !game.board[colorY2][x]) {\r\n      moves.push({x: x, y: colorY2})\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < 2; i++) {\r\n    figX = figXArray[i]\r\n    if (colorY < 8 && colorY >= 0 && board[colorY][figX] &&\r\n    board[colorY][figX].color !== this.color) moves.push({x: figX, y: colorY})\r\n  }\r\n\r\n  // Check for en-passant\r\n  for (let i = 0; i < 2; i++) {\r\n    figX = figXArray[i]\r\n    last = turn[length - 1]\r\n\r\n    if (\r\n      last && last.type === 'pawn' && last.to.x === figX && last.to.y === y &&\r\n      last.color !== this.color && (last.from.y === 1 || last.from.y === 6) && (y === 3 || y === 4)\r\n    ) {\r\n      moves.push({\r\n        x: figX,\r\n        y: colorY,\r\n        movePiece: {\r\n          piece: game.board[y][figX],\r\n          from: {\r\n            x: figX,\r\n            y: y\r\n          },\r\n          to: null\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  var validMoves = []\r\n  if (simulate) {\r\n    validMoves = game.simulateAndFilter(moves, this)\r\n  } else {\r\n    validMoves = moves\r\n  }\r\n\r\n  return validMoves\r\n}\r\n\r\nPiece.pawn = function (x, y, color, game) {\r\n  return new Pawn(x, y, color, game)\r\n}\r\n\r\n// //\r\n\r\nfunction Rook (x, y, color, game) {\r\n  Piece.call(this, x, y, PIECE_CHARS.rook, color, game, 'rook')\r\n}\r\n\r\nRook.prototype = Piece.empty()\r\nRook.prototype.getValidMoves = function (simulate) {\r\n  var game = this.game\r\n  var moves = [];\r\n\r\n  [[-1, 0], [1, 0], [0, 1], [0, -1]].forEach(function (coef) {\r\n    var index, x, y, piece\r\n    for (index = 1; ; index++) {\r\n      x = this.x + coef[0] * index\r\n      y = this.y + coef[1] * index\r\n      if (y < 0 || y > 7 || x < 0 || x > 7) break\r\n\r\n      piece = game.board[y][x]\r\n      if (piece && piece.color === this.color) break\r\n\r\n      moves.push({x: x, y: y})\r\n      if (piece) break\r\n    }\r\n  }, this)\r\n\r\n  var validMoves = []\r\n  if (simulate) {\r\n    validMoves = game.simulateAndFilter(moves, this)\r\n  } else {\r\n    validMoves = moves\r\n  }\r\n\r\n  return validMoves\r\n}\r\n\r\nPiece.rook = function (x, y, color, game) {\r\n  return new Rook(x, y, color, game)\r\n}\r\n\r\n// //\r\n\r\nfunction Knight (x, y, color, game) {\r\n  Piece.call(this, x, y, PIECE_CHARS.knight, color, game, 'knight')\r\n}\r\n\r\nKnight.prototype = Piece.empty()\r\nKnight.prototype.getValidMoves = function (simulate) {\r\n  var game = this.game\r\n  var moves = []\r\n\r\n  var coordinates = [ [2, 1], [-2, 1], [1, 2], [-1, 2], [2, -1], [-2, -1], [1, -2], [-1, -2] ]\r\n\r\n  var one, two\r\n  for (var i = 0; i < coordinates.length; i++) {\r\n    var help = false\r\n    var boardPiece\r\n    one = coordinates[i][0]\r\n    two = coordinates[i][1]\r\n\r\n    if (this.x + one < 8 && this.x + one >= 0 && this.y + two < 8 && this.y + two >= 0) {\r\n      boardPiece = game.board[this.y + two][this.x + one]\r\n      help = boardPiece ? boardPiece.color !== this.color : true\r\n    }\r\n\r\n    if (help) {\r\n      moves.push({x: this.x + one, y: this.y + two})\r\n    }\r\n  }\r\n\r\n  var validMoves = []\r\n  if (simulate) {\r\n    validMoves = game.simulateAndFilter(moves, this)\r\n  } else {\r\n    validMoves = moves\r\n  }\r\n\r\n  return validMoves\r\n}\r\n\r\nPiece.knight = function (x, y, color, game) {\r\n  return new Knight(x, y, color, game)\r\n}\r\n\r\n// //\r\n\r\nfunction Bishop (x, y, color, game) {\r\n  Piece.call(this, x, y, PIECE_CHARS.bishop, color, game, 'bishop')\r\n}\r\n\r\nBishop.prototype = Piece.empty()\r\nBishop.prototype.getValidMoves = function (simulate) {\r\n  var game = this.game\r\n  var moves = [];\r\n\r\n  [[-1, -1], [1, 1], [-1, 1], [1, -1]].forEach(function (coef) {\r\n    var index, x, y, piece\r\n    for (index = 1; ; index++) {\r\n      x = this.x + coef[0] * index\r\n      y = this.y + coef[1] * index\r\n      if (y < 0 || y > 7 || x < 0 || x > 7) break\r\n\r\n      piece = game.board[y][x]\r\n      if (piece && piece.color === this.color) break\r\n\r\n      moves.push({x: x, y: y})\r\n      if (piece) break\r\n    }\r\n  }, this)\r\n\r\n  var validMoves = []\r\n  if (simulate) {\r\n    validMoves = game.simulateAndFilter(moves, this)\r\n  } else {\r\n    validMoves = moves\r\n  }\r\n\r\n  return validMoves\r\n}\r\n\r\nPiece.bishop = function (x, y, color, game) {\r\n  return new Bishop(x, y, color, game)\r\n}\r\n\r\n// //\r\n\r\nfunction Queen (x, y, color, game) {\r\n  Piece.call(this, x, y, PIECE_CHARS.queen, color, game, 'queen')\r\n}\r\n\r\nQueen.prototype = Piece.empty()\r\nQueen.prototype.getValidMoves = function (simulate) {\r\n  var game = this.game\r\n  var rookMoves = Rook.prototype.getValidMoves.call(this)\r\n  var bishopMoves = Bishop.prototype.getValidMoves.call(this)\r\n  var moves = rookMoves.concat(bishopMoves)\r\n\r\n  var validMoves = []\r\n  if (simulate) {\r\n    validMoves = game.simulateAndFilter(moves, this)\r\n  } else {\r\n    validMoves = moves\r\n  }\r\n\r\n  return validMoves\r\n}\r\n\r\nPiece.queen = function (x, y, color, game) {\r\n  return new Queen(x, y, color, game)\r\n}\r\n\r\n// //\r\n\r\nfunction King (x, y, color, game) {\r\n  Piece.call(this, x, y, PIECE_CHARS.king, color, game, 'king')\r\n}\r\n\r\nKing.prototype = Piece.empty()\r\nKing.prototype.getValidMoves = function (simulate) {\r\n  var moves = []\r\n  var coordinates = [ [0, 1], [0, -1], [1, 1], [-1, -1], [1, -1], [-1, 1], [-1, 0], [1, 0] ]\r\n  var x = this.x\r\n  var y = this.y\r\n  var game = this.game\r\n  var turn = game.turn\r\n  var self = this\r\n\r\n  coordinates.forEach(function (coord) {\r\n    var piece\r\n    var xx = x + coord[0]\r\n    var yy = y + coord[1]\r\n\r\n    if (xx < 8 && xx >= 0 && yy < 8 && yy >= 0) {\r\n      piece = game.board[yy][xx]\r\n      if (!piece || piece.color !== self.color) {\r\n        moves.push({x: xx, y: yy})\r\n      }\r\n    }\r\n  })\r\n\r\n  // Check king hasn't moved\r\n  var kingMoved = turn.some(function (turn) {\r\n    return turn.type === 'king' && turn.color === self.color\r\n  })\r\n\r\n  if (!kingMoved) {\r\n    [[0, 2, -1], [7, 6, +1]].forEach(function (props) {\r\n      var rookX = props[0]\r\n      var newKingX = props[1]\r\n      var dir = props[2]\r\n      var rook = game.board[y][rookX]\r\n\r\n      // Check rook on position\r\n      if (!rook || !rook.type === 'rook') return\r\n\r\n      // Check rook hasn't moved\r\n      if (turn.some(function (ev) {\r\n        return ev.from.x === rookX && ev.from.y === y\r\n      })) return\r\n\r\n      // Check squares empty and safe\r\n      for (var xx = x + dir; xx !== rookX; xx += dir) {\r\n        if (game.board[y][xx]) return\r\n        var safe = true\r\n        game.board.forEach(function (ev) {\r\n          ev.forEach(function (evv) {\r\n            if (evv && evv.type !== 'king' && evv.color !== self.color) {\r\n              evv.getValidMoves().forEach(function (evMove) {\r\n                if (evMove && evMove.y === y && evMove.x === xx) safe = false\r\n              })\r\n            }\r\n          })\r\n        })\r\n        if (!safe) return\r\n      }\r\n\r\n      var rochade = {\r\n        x: newKingX,\r\n        y: y,\r\n        movePiece: {\r\n          piece: self.game.board[y][rookX],\r\n          from: {\r\n            x: rookX, y: y\r\n          },\r\n          to: {\r\n            y: y, x: x + dir\r\n          }\r\n        }\r\n      }\r\n\r\n      moves.push(rochade)\r\n    })\r\n  }\r\n\r\n  var validMoves = []\r\n  if (simulate) {\r\n    validMoves = game.simulateAndFilter(moves, self)\r\n  } else {\r\n    validMoves = moves\r\n  }\r\n\r\n  return validMoves\r\n}\r\n\r\nPiece.king = function (x, y, color, game) {\r\n  return new King(x, y, color, game)\r\n}\r\n\r\nexport { Piece, Pawn, Rook, Knight, Bishop, Queen, King }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pieces.js","//\r\n// RSG Chess\r\n// Licensed under Apache 2.0 LICENSE\r\n\r\nimport Game from './game.js'\r\n\r\nconst ChessAI = function (depth, gameState, isMaximisingPlayer) {\r\n  // Clone the gameState to access all game associated methods.\r\n  // This usually doesn't make sense, but sometimes you cannot post functions to a backend or a web-worker\r\n  // and that's why we're touching the game methods from new game configuration intead from the passed argument.\r\n  // So if you pass {board: [myBoard], turn:[myTurn],...} for the game argument it will actually work!\r\n  // Already described here: https://github.com/RSG-Group/Chess/issues/8#issuecomment-381245794\r\n  var game = Game.prototype.initializeGame()\r\n\r\n  for (var i = 0; i < 8; i++) {\r\n    for (var j = 0; j < 8; j++) {\r\n      if (gameState.board[i][j]) {\r\n        let currentCell = gameState.board[i][j]\r\n        game.piece(currentCell.type, j, i, currentCell.color)\r\n      } else {\r\n        game.board[i][j] = null\r\n      }\r\n    }\r\n  }\r\n\r\n  game.turn = gameState.turn\r\n  game.threefold = gameState.threefold\r\n  game.FEN = gameState.FEN\r\n  game.FENboard = gameState.FENboard\r\n\r\n  // Start looping and simulating all valid moves\r\n  var allMoves = game.allMoves()\r\n  var bestValue = -9999\r\n  var bestMove\r\n\r\n  for (var i = 0; i < allMoves.length; i++) {\r\n    var newGameMove = allMoves[i]\r\n    var undo = game.simpleMove(newGameMove)\r\n    var boradValue = minimax(depth - 1, game, -10000, 10000, !isMaximisingPlayer)\r\n    undo()\r\n    if (boradValue >= bestValue) {\r\n      bestValue = boradValue\r\n      bestMove = newGameMove\r\n    }\r\n  }\r\n  return bestMove\r\n}\r\n\r\nvar minimax = function (depth, game, alpha, beta, isMaximisingPlayer) {\r\n  if (depth === 0) {\r\n    return -evaluateBoard(game.board)\r\n  }\r\n\r\n  var allMoves = game.allMoves()\r\n  if (isMaximisingPlayer) {\r\n    let bestValue = -9999\r\n    for (let i = 0; i < allMoves.length; i++) {\r\n      let undo = game.simpleMove(allMoves[i])\r\n      bestValue = Math.max(bestValue, minimax(depth - 1, game, alpha, beta, !isMaximisingPlayer))\r\n      undo()\r\n      alpha = Math.max(alpha, bestValue)\r\n      if (beta <= alpha) {\r\n        return bestValue\r\n      }\r\n    }\r\n    return bestValue\r\n  } else {\r\n    let bestValue = 9999\r\n    for (let i = 0; i < allMoves.length; i++) {\r\n      let undo = game.simpleMove(allMoves[i])\r\n      bestValue = Math.min(bestValue, minimax(depth - 1, game, alpha, beta, !isMaximisingPlayer))\r\n      undo()\r\n      beta = Math.min(beta, bestValue)\r\n      if (beta <= alpha) {\r\n        return bestValue\r\n      }\r\n    }\r\n    return bestValue\r\n  }\r\n}\r\n\r\nvar evaluateBoard = function (board) {\r\n  var totalEvaluation = 0\r\n  for (var i = 0; i < 8; i++) {\r\n    for (var j = 0; j < 8; j++) {\r\n      // calculate the current evaluation\r\n      totalEvaluation = totalEvaluation + getPieceValue(board[i][j])\r\n    }\r\n  }\r\n  // return the total evaluation\r\n  return totalEvaluation\r\n}\r\n\r\nvar getPieceValue = function (piece) {\r\n  if (piece === null) {\r\n    return 0\r\n  }\r\n\r\n  // get value for every piece on the board\r\n  var getAbsoluteValue = function (piece) {\r\n    if (piece.type === 'pawn') {\r\n      return 10\r\n    } else if (piece.type === 'rook') {\r\n      return 50\r\n    } else if (piece.type === 'knight') {\r\n      return 30\r\n    } else if (piece.type === 'bishop') {\r\n      return 30\r\n    } else if (piece.type === 'queen') {\r\n      return 90\r\n    } else if (piece.type === 'king') {\r\n      return 900\r\n    }\r\n  }\r\n\r\n  // calculate the absolute value and return it\r\n  var absoluteValue = getAbsoluteValue(piece, piece.color === 'W')\r\n  return piece.color === 'W' ? absoluteValue : -absoluteValue\r\n}\r\n\r\n// export the algorithm\r\nexport default ChessAI\r\n\r\n// Written by Radi Cho\r\n// RSG Chess - by RSG Group\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/AI.js","// Let's import...\r\nimport Game from './game'\r\nimport * as Pieces from './pieces'\r\nimport AI from './AI'\r\n\r\n// And export...\r\nexport {\r\n  Game,\r\n  Pieces,\r\n  AI\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import { Game, AI } from '../src/index'\r\n\r\n// initialize test game configuration\r\nconst game = Game.prototype.initializeGame()\r\ngame.moveSelected(\r\n  game.board[6][0], { y: 5, x: 0 }, () => {}, () => {}, false, false\r\n)\r\n\r\nconst bestAI = new AI(4, game, true)\r\n\r\nconsole.log(bestAI)\r\n\n\n\n// WEBPACK FOOTER //\n// ./test/index.js"],"sourceRoot":""}